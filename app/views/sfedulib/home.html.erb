<body class="home-page">
<nav class="navbar">
     <%= button_to 'Домой', '/1', method: :get, :class=>"button" %> 
  <div class="user-actions">
  <% if @user_type > 0 %>
        <a class = "button" href='/user/1'>
        <%="#{@user.first_name} #{@user.last_name}" %>
        </a>
        <%= button_to 'Выйти', '/logout', method: :get, :class=>"button" %> 
      <% else %>
  <form action="/login" accept-charset="UTF-8" method="post" class="login">
  <input type="hidden" name="authenticity_token" value="10gyJlnXds_2ymbvS8DD1PkNpNd89XgKtIHySTjltkVFMgbmBICgWhG3FCd6n3hwY_kHRzEqE9hFgqvVRJ5I9g" autocomplete="off">          
    <input type="text" name="login" id="login" placeholder="Логин">
    <input type="password" name="password" id="password" placeholder="Пароль">
    <input type="submit" name="commit" value="Войти" class="button" data-disable-with="Войти">
  </form>
      <% end %>
  </div>
</nav>
  
<nav class="sidebar">
  <%= form_tag('/search') do -%>
    <%=text_field_tag 'search', nil, placeholder: 'Поиск по названию', value: "#{@search}"%>
    <%=text_field_tag 'author_search', nil, placeholder: 'Поиск по автору', value: "#{@author_search}"%>
    <%= submit_tag 'Применить', :class=>"button"%>
    <% end -%>
    <div class="pagebar">
      <a class="button" href="/1"><%="<<"%></a>
          <% if @page > 2 %>
        <a class="button" href=<%="/#{@page-2}"%>><%="#{@page-2}"%></a>
          <%-end%>
       <% if @page > 1 %>
      <a class="button" href=<%="/#{@page-1}"%>><%="#{@page-1}"%></a>
        <%-end%>
      <a class="currentbutton"><%="#{@page}"%></a>
        <% if @page < @bookcount/10+1 %>
        <a class="button" href=<%="/#{@page+1}"%>><%="#{@page+1}"%></a>
        <%-end%>
      <% if @page < @bookcount/10 %>
        <a class="button" href=<%="/#{@page+2}"%>><%="#{@page+2}"%></a>
        <%-end%>
      <a class="button" href=<%="#{@bookcount/10+1}"%>><%=">>"%></a>
      </div>
</nav>

<div class="book-list content">
   
    <%- @books.each do |e| %>
    <div class="book-list-item">
      <img class="cover-preview" src="<%=url_for(e.cover)%>"></img>
      <p class="name font"><%="#{e.book_name}"%></p>
        <div class="detail font">
        <div class="authors">
      <% if e.authors.pluck(:author_id).count != 0 %>
          <p>Авторы:</p>
      <%- e.authors.each do |a| %>
        <p><%="#{a.first_name} #{a.last_name}"%></p>
      <%- end %>
      <%end%>
          </div>
            <% if (@user_type == 2 and e.tutor_books.pluck(:tutor_id).count==1)%>
            <p><%="Дата возврата: #{e.tutor_books.first.return_date}"%></p>
            <%else%>
              <% if (@user_type == 1 and e.student_books.pluck(:student_id).count==1) %>
                <p><%="Дата возврата: #{e.student_books.first.return_date}"%></p>
                <%end%>
            <% end %>
      <% if e.count != -1 %>
        <p class="detail font"><%="Книг осталось: #{e.count}"%></p>
      <%end%>
      </div>
        
      <div class="description font">
      <% unless e.description.nil? %>
        <p>Описание:</p> 
        <p><%="#{e.description}"%></p>
      <%end%>
      </div>

      <div class="actions">
        <% if @user_type == 3 or (e.count == -1) or (@user_type == 2 and e.tutor_books.pluck(:tutor_id).count==1) or (@user_type == 1 and e.student_books.pluck(:student_id).count==1) %>
          <form method="get" action="/book/<%=e.id%>">
          <input class="button" value="Читать" type="submit" />
          </form>
          <% end %>
        <% if ((@user_type == 2 and e.tutors.pluck(:tutor_id).count==0) or (@user_type == 1 and e.students.pluck(:student_id).count==0)) and e.count != 0 %>
        <form method="post" action="/book/<%=e.id%>">
        <input class="button" value="Взять" type="submit" />
        </form>
        <% end %>
        <% if (@user_type == 2 and e.tutors.count==1) or (@user_type == 1 and e.students.count==1) %>
        <form method="get" action="/book/<%=e.id%>/edit">
        <input class="button" value="Вернуть" type="submit" />
        </form>
          <form method="post" action="/book/<%=e.id%>/edit">
          <input class="button" value="Продлить" type="submit" />
          </form>
        <% end %>
        <% if @user_type == 3 %>
        <a class="button"  href="#">Редактировать</a>
        <% end %>
      </div>
    </div>
    <%- end %>
</div>
</body>